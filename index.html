/**
 * Função principal para lidar com requisições HTTP POST enviadas para o script como um aplicativo web.
 * Esta função recebe os dados do formulário da sua página HTML e os adiciona a uma planilha do Google Sheets.
 * @param {Object} e O objeto de evento que contém os dados da requisição POST.
 */
function doPost(e) {
  // <<<<<<<< ESTE É O ID DA SUA PLANILHA >>>>>>>>
  // Este valor foi atualizado com o ID que você forneceu.
  const SPREADSHEET_ID = '1PXl7k2lTRCdKn1JlQzaanaP4Fu030jqzrxgJ2TQV1w4'; 
  
  // Nome da aba (sheet) na sua planilha onde as respostas serão salvas.
  // Por padrão, é 'Planilha1'. Se você renomeou, use o nome exato aqui.
  const SHEET_NAME = 'Planilha1'; 

  // Analisa os dados JSON recebidos na requisição POST.
  // Os dados vêm do 'body' da requisição POST do seu formulário HTML.
  const data = JSON.parse(e.postData.contents);
  
  // Abre a planilha usando o ID fornecido.
  const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
  // Obtém a aba específica da planilha pelo nome.
  const sheet = ss.getSheetByName(SHEET_NAME);

  // Verifica se a aba foi encontrada. Se não, retorna uma mensagem de erro.
  if (!sheet) {
    return ContentService.createTextOutput(JSON.stringify({status: 'error', message: `A aba "${SHEET_NAME}" não foi encontrada.`})).setMimeType(ContentService.MimeType.JSON);
  }

  // Mapeia os dados recebidos do formulário para uma array de linha,
  // que será adicionada à planilha.
  // A ORDEM DESTES ITENS DEVE CORRESPONDER EXATAMENTE À ORDEM DOS CABEÇALHOS NA SUA PRIMEIRA LINHA DA PLANILHA.
  const rowData = [
    new Date(), // Coluna 1: Timestamp (data e hora do envio)
    data.userId, // Coluna 2: ID do Usuário
    data.fullName, // Coluna 3: Nome Completo
    data.email, // Coluna 4: Email
    data.phone, // Coluna 5: Telefone
    data.linkedin, // Coluna 6: LinkedIn
    data.salesExperience, // Coluna 7: Experiência em Vendas
    data.highValueSales, // Coluna 8: Vendas Alto Valor (Sim/Não)
    data.highValueSalesText, // Coluna 9: Detalhes Vendas Alto Valor
    data.managementKnowledge, // Coluna 10: Conhecimento Gestão
    data.stayUpdated, // Coluna 11: Atualização Mercado
    data.proactivity, // Coluna 12: Proatividade
    data.challengingGoal, // Coluna 13: Meta Desafiadora
    data.objectionHandling, // Coluna 14: Lidar com Objeções
    data.activeListening, // Coluna 15: Escuta Ativa
    data.adaptability, // Coluna 16: Adaptabilidade
    data.consultativeSales, // Coluna 17: Vendas Consultivas (Sim/Não/Não Conheço)
    data.consultativeSalesText, // Coluna 18: Detalhes Vendas Consultivas
    data.crmExperience, // Coluna 19: Experiência CRM
    data.negotiation, // Coluna 20: Negociação
    data.presentationComfort, // Coluna 21: Conforto Apresentação
    data.remunerationModel, // Coluna 22: Modelo Remuneração
    data.longTermSuccess, // Coluna 23: Sucesso Longo Prazo
    data.learningEnvironment, // Coluna 24: Ambiente Aprendizado
    data.teamContribution, // Coluna 25: Contribuição Equipe
    data.motivation, // Coluna 26: Motivação
    data.productComfort, // Coluna 27: Conforto Produto
    data.scenarioQuestions, // Coluna 28: Perguntas Cenário
    data.mentoringArguments, // Coluna 29: Argumentos Mentoria
    data.financialImpact, // Coluna 30: Impacto Financeiro
    data.preliminaryScore, // Coluna 31: Pontuação Preliminar (calculada no JavaScript do frontend)
    data.aiProfileSummary // Coluna 32: Resumo da IA (gerado pela Gemini API no frontend)
  ];

  // Adiciona a nova linha de dados à planilha.
  sheet.appendRow(rowData); 

  // Retorna uma resposta de sucesso.
  // Nota: Devido ao 'mode: no-cors' no frontend, esta resposta não será lida pelo JavaScript da sua página.
  // A confirmação do sucesso será visual na sua planilha.
  return ContentService.createTextOutput(JSON.stringify({status: 'success', message: 'Dados salvos com sucesso!'})).setMimeType(ContentService.MimeType.JSON);
}
