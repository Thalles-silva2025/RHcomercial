<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questionário para Vendedores - Hub Business</title>
    <!-- Tailwind CSS CDN para um design moderno e responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define a fonte Inter para todo o corpo do documento */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Cor de fundo suave */
        }
        /* Estilos para o modal de feedback */
        .modal {
            display: none; /* Escondido por padrão */
            position: fixed; /* Posição fixa na tela */
            z-index: 1000; /* Acima de outros elementos */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; /* Habilita scroll se o conteúdo for muito grande */
            background-color: rgba(0,0,0,0.4); /* Fundo semi-transparente */
            justify-content: center; /* Centraliza o conteúdo horizontalmente */
            align-items: center; /* Centraliza o conteúdo verticalmente */
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 2.5rem; /* Aumenta o padding */
            border-radius: 0.75rem; /* Bordas mais arredondadas */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* Sombra mais pronunciada */
            width: 90%; /* Largura responsiva */
            max-width: 600px; /* Largura máxima */
            text-align: center;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 2rem; /* Tamanho maior para o botão de fechar */
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: #333;
            text-decoration: none;
            cursor: pointer;
        }
        /* Estilo para campos de rádio/checkbox com label */
        .radio-option {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .radio-option input[type="radio"] {
            margin-right: 0.5rem;
        }
        /* Estilo para o spinner de carregamento */
        .loader {
            border: 4px solid #f3f3f3; /* Cinza claro */
            border-top: 4px solid #3498db; /* Azul */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-4xl">
        <h1 class="text-4xl font-extrabold text-center text-gray-900 mb-6">
            Questionário para Vendedores de Alta Performance
        </h1>
        <h2 class="text-2xl font-semibold text-center text-indigo-700 mb-8">
            Hub Business
        </h2>
        <p class="text-gray-700 text-lg mb-8 text-center leading-relaxed">
            Bem-vindo(a)! Este questionário foi desenvolvido para conhecermos melhor o seu perfil e avaliarmos seu alinhamento com a nossa visão de crescimento e as expectativas para a posição de Vendedor(a) de Alta Performance no Hub Business. Suas respostas nos ajudarão a identificar os talentos que buscam não apenas ganhos financeiros substanciais, mas também um ambiente de desenvolvimento contínuo e propósito.
        </p>

        <!-- Exibição do ID do Usuário (para fins de depuração e rastreamento) -->
        <div class="text-sm text-gray-500 text-right mb-4">
            Seu ID de Usuário: <span id="userIdDisplay" class="font-mono text-gray-700">Carregando...</span>
        </div>

        <form id="salesAssessmentForm" class="space-y-8">
            <!-- Seção 1: Dados Pessoais e Contato -->
            <div class="bg-indigo-50 p-6 rounded-lg shadow-sm">
                <h3 class="text-2xl font-bold text-indigo-800 mb-4">Seção 1: Dados Pessoais e Contato</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="fullName" class="block text-gray-700 text-sm font-semibold mb-2">Nome Completo:</label>
                        <input type="text" id="fullName" name="fullName" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required>
                    </div>
                    <div>
                        <label for="email" class="block text-gray-700 text-sm font-semibold mb-2">E-mail:</label>
                        <input type="email" id="email" name="email" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required>
                    </div>
                    <div>
                        <label for="phone" class="block text-gray-700 text-sm font-semibold mb-2">Telefone para Contato:</label>
                        <input type="tel" id="phone" name="phone" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required>
                    </div>
                    <div>
                        <label for="linkedin" class="block text-gray-700 text-sm font-semibold mb-2">Link do LinkedIn (se tiver):</label>
                        <input type="url" id="linkedin" name="linkedin" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                </div>
            </div>

            <!-- Seção 2: Experiência e Conhecimento de Mercado -->
            <div class="bg-indigo-50 p-6 rounded-lg shadow-sm">
                <h3 class="text-2xl font-bold text-indigo-800 mb-4">Seção 2: Experiência e Conhecimento de Mercado</h3>
                <div class="space-y-6">
                    <div>
                        <label for="salesExperience" class="block text-gray-700 text-sm font-semibold mb-2">Descreva sua experiência prévia em vendas. Qual o tipo de produto/serviço você vendia e para qual público (B2B, B2C, ou ambos)?</label>
                        <textarea id="salesExperience" name="salesExperience" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Você tem experiência em vendas de produtos ou serviços de alto valor agregado (ticket médio alto), consultivos ou complexos?</label>
                        <div class="flex flex-col space-y-2">
                            <label class="radio-option">
                                <input type="radio" name="highValueSales" value="sim" onchange="toggleConditionalText('highValueSalesText', this.value === 'sim')" required> Sim
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="highValueSales" value="nao" onchange="toggleConditionalText('highValueSalesText', this.value === 'sim')"> Não
                            </label>
                        </div>
                        <textarea id="highValueSalesText" name="highValueSalesText" rows="2" class="w-full p-3 border border-gray-300 rounded-md mt-2 hidden" placeholder="Se sim, descreva brevemente."></textarea>
                    </div>
                    <div>
                        <label for="managementKnowledge" class="block text-gray-700 text-sm font-semibold mb-2">Você possui conhecimento em gestão empresarial (financeira, de pessoas, processos, marketing, vendas)? Se sim, por favor, detalhe sua familiaridade com esses conceitos.</label>
                        <textarea id="managementKnowledge" name="managementKnowledge" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                    </div>
                    <div>
                        <label for="stayUpdated" class="block text-gray-700 text-sm font-semibold mb-2">Como você se mantém atualizado sobre o cenário econômico e as tendências de negócios para adaptar sua abordagem de vendas?</label>
                        <textarea id="stayUpdated" name="stayUpdated" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                    </div>
                </div>
            </div>

            <!-- Seção 3: Habilidades Comportamentais (Soft Skills) -->
            <div class="bg-indigo-50 p-6 rounded-lg shadow-sm">
                <h3 class="text-2xl font-bold text-indigo-800 mb-4">Seção 3: Habilidades Comportamentais (Soft Skills)</h3>
                <div class="space-y-6">
                    <div>
                        <label for="proactivity" class="block text-gray-700 text-sm font-semibold mb-2">Descreva uma situação em que você demonstrou forte proatividade e iniciativa para gerar novas oportunidades de vendas (perfil "Hunter").</label>
                        <textarea id="proactivity" name="proactivity" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                    </div>
                    <div>
                        <label for="challengingGoal" class="block text-gray-700 text-sm font-semibold mb-2">Qual foi a meta de vendas mais desafiadora que você já teve e como você se organizou e persistiu para alcançá-la ou superá-la?</label>
                        <textarea id="challengingGoal" name="challengingGoal" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                    </div>
                    <div>
                        <label for="objectionHandling" class="block text-gray-700 text-sm font-semibold mb-2">Conte sobre uma experiência em que você precisou lidar com uma objeção complexa de um cliente. Como você abordou a situação e qual foi o resultado?</label>
                        <textarea id="objectionHandling" name="objectionHandling" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                    </div>
                    <div>
                        <label for="activeListening" class="block text-gray-700 text-sm font-semibold mb-2">Como você utiliza a escuta ativa para compreender as necessidades do cliente e construir rapport durante o processo de vendas? Dê um exemplo.</label>
                        <textarea id="activeListening" name="activeListening" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                    </div>
                    <div>
                        <label for="adaptability" class="block text-gray-700 text-sm font-semibold mb-2">Você se considera adaptável e aberto a novas metodologias e feedbacks? Dê um exemplo de como você buscou aprimoramento profissional recentemente.</label>
                        <textarea id="adaptability" name="adaptability" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                    </div>
                </div>
            </div>

            <!-- Seção 4: Habilidades Técnicas (Hard Skills) -->
            <div class="bg-indigo-50 p-6 rounded-lg shadow-sm">
                <h3 class="text-2xl font-bold text-indigo-800 mb-4">Seção 4: Habilidades Técnicas (Hard Skills)</h3>
                <div class="space-y-6">
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Você possui experiência com técnicas de vendas consultivas (ex: SPIN Selling, Challenger Sale)?</label>
                        <div class="flex flex-col space-y-2">
                            <label class="radio-option">
                                <input type="radio" name="consultativeSales" value="sim" onchange="toggleConditionalText('consultativeSalesText', this.value === 'sim')" required> Sim
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="consultativeSales" value="nao" onchange="toggleConditionalText('consultativeSalesText', this.value === 'sim')"> Não
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="consultativeSales" value="nao_conheco" onchange="toggleConditionalText('consultativeSalesText', this.value === 'sim')"> Não conheço
                            </label>
                        </div>
                        <textarea id="consultativeSalesText" name="consultativeSalesText" rows="2" class="w-full p-3 border border-gray-300 rounded-md mt-2 hidden" placeholder="Se sim, qual sua familiaridade e como você as aplica?"></textarea>
                    </div>
                    <div>
                        <label for="crmExperience" class="block text-gray-700 text-sm font-semibold mb-2">Qual sua experiência com ferramentas de CRM (Customer Relationship Management) para gerenciar seu pipeline de vendas e acompanhar leads? Cite as ferramentas que você já utilizou.</label>
                        <textarea id="crmExperience" name="crmExperience" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                    </div>
                    <div>
                        <label for="negotiation" class="block text-gray-700 text-sm font-semibold mb-2">Descreva sua habilidade em conduzir negociações complexas e fechar vendas de alto valor. Compartilhe um exemplo de uma negociação bem-sucedida.</label>
                        <textarea id="negotiation" name="negotiation" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Você se sente confortável em criar e apresentar propostas e soluções de forma impactante para diferentes públicos (indivíduos, pequenas, médias ou grandes empresas)?</label>
                        <div class="flex flex-col space-y-2">
                            <label class="radio-option">
                                <input type="radio" name="presentationComfort" value="sim" required> Sim
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="presentationComfort" value="em_desenvolvimento"> Em desenvolvimento
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="presentationComfort" value="nao"> Não
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção 5: Alinhamento Cultural e Expectativas -->
            <div class="bg-indigo-50 p-6 rounded-lg shadow-sm">
                <h3 class="text-2xl font-bold text-indigo-800 mb-4">Seção 5: Alinhamento Cultural e Expectativas</h3>
                <div class="space-y-6">
                    <div>
                        <label for="remunerationModel" class="block text-gray-700 text-sm font-semibold mb-2">O Hub Business oferece uma estrutura de comissionamento de 7% a 15% sobre o valor dos produtos, com uma meta de comissão de R$ 20.000,00 mensais em até 6 meses. Como você se sente em relação a um modelo de remuneração predominantemente com base em comissão e metas desafiadoras?</label>
                        <textarea id="remunerationModel" name="remunerationModel" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Você compreende que o sucesso no Hub Business, com produtos de alto valor agregado, é construído a longo prazo, através do desenvolvimento de relacionamentos e da entrega de valor consistente ao cliente?</label>
                        <div class="flex flex-col space-y-2">
                            <label class="radio-option">
                                <input type="radio" name="longTermSuccess" value="sim" required> Sim
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="longTermSuccess" value="nao"> Não
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="longTermSuccess" value="mais_informacoes"> Preciso de mais informações
                            </label>
                        </div>
                    </div>
                    <div>
                        <label for="learningEnvironment" class="block text-gray-700 text-sm font-semibold mb-2">Nosso plano inclui um Centro de Treinamento de Vendedores e mentoria contínua. Qual a sua expectativa em relação a um ambiente de aprendizado e desenvolvimento profissional contínuo?</label>
                        <textarea id="learningEnvironment" name="learningEnvironment" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                    </div>
                    <div>
                        <label for="teamContribution" class="block text-gray-700 text-sm font-semibold mb-2">A cultura do Hub Business valoriza a colaboração e o compartilhamento de experiências. Como você acredita que pode contribuir para o enriquecimento coletivo da equipe de vendas?</label>
                        <textarea id="teamContribution" name="teamContribution" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                    </div>
                    <div>
                        <label for="motivation" class="block text-gray-700 text-sm font-semibold mb-2">Qual a sua motivação para buscar uma oportunidade com potencial de ganhos acima de R$ 20.000,00 por mês em comissões?</label>
                        <textarea id="motivation" name="motivation" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">O Hub Business trabalha com uma esteira de produtos que incluem o "Hub Business Full" (R$ 20.000,00), "Hub Business Customer" (R$ 4.000/mês), e mentorias/palestras de valores diversos. Você se sente confortável em vender produtos e serviços de diferentes valores e formatos?</label>
                        <div class="flex flex-col space-y-2">
                            <label class="radio-option">
                                <input type="radio" name="productComfort" value="sim" required> Sim
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="productComfort" value="em_desenvolvimento"> Em desenvolvimento
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="productComfort" value="nao"> Não
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção 6: Cenário e Análise de Raciocínio -->
            <div class="bg-indigo-50 p-6 rounded-lg shadow-sm">
                <h3 class="text-2xl font-bold text-indigo-800 mb-4">Seção 6: Cenário e Análise de Raciocínio</h3>
                <div class="space-y-6">
                    <div>
                        <label for="scenarioQuestions" class="block text-gray-700 text-sm font-semibold mb-2">Imagine que você está em uma prospecção para vender o "Hub Business Full" (R$ 20.000,00) para uma pequena empresa que expressou interesse em "organizar melhor suas finanças". Quais seriam as 3 primeiras perguntas que você faria para qualificar essa necessidade e iniciar uma venda consultiva?</label>
                        <textarea id="scenarioQuestions" name="scenarioQuestions" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                    </div>
                    <div>
                        <label for="mentoringArguments" class="block text-gray-700 text-sm font-semibold mb-2">Um cliente potencial está muito interessado na "Mentoria Individual Thalles Sampaio" (R$ 38.000,00), mas está hesitante devido ao alto investimento. Quais argumentos de venda você utilizaria para demonstrar o ROI (Retorno sobre Investimento) e o valor transformacional dessa mentoria?</label>
                        <textarea id="mentoringArguments" name="mentoringArguments" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                    </div>
                    <div>
                        <label for="financialImpact" class="block text-gray-700 text-sm font-semibold mb-2">Você atingiu R$ 100.000,00 em vendas no mês e está se esforçando para alcançar R$ 200.000,00. Analisando a tabela de comissionamento, qual o impacto financeiro de passar de R$ 100.000,00 para R$ 200.000,00 em vendas e como isso o motivaria?</label>
                        <textarea id="financialImpact" name="financialImpact" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                    </div>
                </div>
            </div>

            <button type="submit" id="submitButton" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition duration-300 ease-in-out transform hover:scale-105 shadow-md">
                Enviar Questionário
            </button>
        </form>
    </div>

    <!-- Modal de Resultado/Feedback -->
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <h2 class="text-3xl font-bold text-gray-900 mb-4">Questionário Enviado!</h2>
            <p class="text-lg text-gray-700 mb-6">Agradecemos o seu interesse no Hub Business. Suas respostas foram recebidas e serão analisadas com cuidado.</p>
            <div id="loadingSpinner" class="loader hidden"></div> <!-- Spinner de carregamento -->
            <div id="evaluationResult" class="text-left bg-gray-50 p-4 rounded-md border border-gray-200 hidden">
                <h3 class="text-xl font-semibold text-gray-800 mb-2">Pré-Avaliação Simplificada:</h3>
                <p id="scoreMessage" class="text-gray-700 mb-4"></p>
                <h3 class="text-xl font-semibold text-gray-800 mb-2">Resumo do Perfil (Análise de IA):</h3>
                <p id="aiSummary" class="text-gray-700 leading-relaxed"></p>
                <p class="text-gray-600 mt-4 text-sm">
                    <strong class="text-red-600">Atenção:</strong> Esta é uma avaliação simplificada e análise de IA para demonstração. O processo real de seleção envolve uma análise mais aprofundada das suas respostas e etapas adicionais.
                </p>
            </div>
            <button onclick="closeModal()" class="mt-8 bg-indigo-600 text-white font-bold py-2 px-5 rounded-lg hover:bg-indigo-700 transition duration-300 ease-in-out">
                Fechar
            </button>
        </div>
    </div>

    <script type="module">
        // Importações do Firebase SDK (mantidas para o ID do usuário, mas o salvamento no Firestore é opcional)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, collection, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Variáveis globais do Firebase (fornecidas pelo ambiente Canvas)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // <<<<<<<< IMPORTANTE: SUBSTITUA PELO URL DO SEU GOOGLE APPS SCRIPT >>>>>>>>
        // Você obtém este URL após implantar o script como um aplicativo web.
        const GOOGLE_APPS_SCRIPT_URL = https://script.google.com/macros/s/AKfycbyi-PkeQzPQV_IzqxRwNPgTFbtVSg7Qa76oceLID5yRAo8mk8VlwZjViTfftgN7QoE5dA/exec; 

        let app;
        let db;
        let auth;
        let userId = 'anon'; // ID do usuário, padrão para anônimo até autenticação

        // Inicializa o Firebase e autentica o usuário
        async function initializeFirebaseAndAuth() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Tenta autenticar com token personalizado, senão de forma anônima
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // Monitora o estado de autenticação para obter o UID do usuário
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('userIdDisplay').textContent = userId;
                        console.log("Usuário autenticado ID:", userId);
                    } else {
                        // Gera um ID aleatório se não houver autenticação (para rastreamento básico)
                        userId = crypto.randomUUID(); 
                        document.getElementById('userIdDisplay').textContent = userId;
                        console.log("Sessão encerrada ou anônima. ID gerado:", userId);
                    }
                });
            } catch (error) {
                console.error("Erro ao inicializar Firebase ou autenticar:", error);
                document.getElementById('userIdDisplay').textContent = 'Erro ao carregar ID';
            }
        }

        // Chama a inicialização do Firebase quando a janela carrega
        window.onload = initializeFirebaseAndAuth;

        /**
         * Alterna a visibilidade de um campo de texto condicional.
         * @param {string} id O ID do elemento textarea.
         * @param {boolean} show Se o elemento deve ser mostrado (true) ou escondido (false).
         */
        function toggleConditionalText(id, show) {
            const element = document.getElementById(id);
            if (element) { // Garante que o elemento existe antes de manipular
                if (show) {
                    element.classList.remove('hidden');
                    element.setAttribute('required', 'true');
                } else {
                    element.classList.add('hidden');
                    element.removeAttribute('required');
                    element.value = ''; // Limpa o valor quando escondido
                }
            }
        }

        /**
         * Abre o modal de feedback.
         */
        function openModal() {
            document.getElementById('resultModal').style.display = 'flex';
        }

        /**
         * Fecha o modal de feedback e reseta o formulário.
         */
        function closeModal() {
            document.getElementById('resultModal').style.display = 'none';
            document.getElementById('salesAssessmentForm').reset(); // Reseta todos os campos do formulário
            document.getElementById('evaluationResult').classList.add('hidden'); // Esconde a seção de resultados
            document.getElementById('loadingSpinner').classList.add('hidden'); // Esconde o spinner
            // Garante que campos condicionais voltem ao estado inicial (escondidos e não obrigatórios)
            toggleConditionalText('highValueSalesText', false);
            toggleConditionalText('consultativeSalesText', false);
        }

        // Event Listener para a submissão do formulário
        document.getElementById('salesAssessmentForm').addEventListener('submit', async function(event) {
            event.preventDefault(); // Previne o envio padrão do formulário

            const form = event.target;
            const submitButton = document.getElementById('submitButton');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const evaluationResultDiv = document.getElementById('evaluationResult');
            const aiSummaryElement = document.getElementById('aiSummary');
            const scoreMessageElement = document.getElementById('scoreMessage');

            // Desabilita o botão de envio e mostra o spinner de carregamento
            submitButton.disabled = true;
            submitButton.textContent = 'Enviando...';
            loadingSpinner.classList.remove('hidden');
            evaluationResultDiv.classList.add('hidden'); // Esconde resultados anteriores
            aiSummaryElement.textContent = ''; // Limpa o resumo anterior da IA
            scoreMessageElement.textContent = ''; // Limpa a pontuação anterior
            openModal(); // Abre o modal com o spinner

            // Coleta os dados do formulário
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });

            // Lógica de pontuação preliminar simplificada (para demonstração)
            let score = 0;
            let feedback = [];

            // Seção 2: Experiência e Conhecimento de Mercado
            if (data.highValueSales === 'sim' && data.highValueSalesText && data.highValueSalesText.length > 10) {
                score += 10;
                feedback.push("Experiência em vendas de alto valor: Ponto positivo.");
            }
            if (data.managementKnowledge && (data.managementKnowledge.toLowerCase().includes('gestão financeira') || data.managementKnowledge.toLowerCase().includes('processos'))) {
                score += 5;
                feedback.push("Conhecimento em gestão empresarial: Bom alinhamento.");
            }

            // Seção 3: Habilidades Comportamentais (Soft Skills)
            if (data.proactivity && data.proactivity.length > 20 && data.challengingGoal && data.challengingGoal.length > 20) {
                score += 10;
                feedback.push("Demonstra proatividade e resiliência com metas.");
            }
            if (data.objectionHandling && data.objectionHandling.length > 20 && data.activeListening && data.activeListening.length > 20) {
                score += 10;
                feedback.push("Habilidade em lidar com objeções e escuta ativa.");
            }
            if (data.adaptability && data.adaptability.length > 20) {
                score += 5;
                feedback.push("Abertura para aprendizado e adaptação.");
            }

            // Seção 4: Habilidades Técnicas (Hard Skills)
            if (data.consultativeSales === 'sim' && data.consultativeSalesText && (data.consultativeSalesText.toLowerCase().includes('spin selling') || data.consultativeSalesText.toLowerCase().includes('challenger sale'))) {
                score += 10;
                feedback.push("Familiaridade com técnicas de vendas consultivas avançadas.");
            } else if (data.consultativeSales === 'sim') {
                score += 5;
                feedback.push("Experiência com vendas consultivas.");
            }
            if (data.crmExperience && data.crmExperience.length > 10) {
                score += 5;
                feedback.push("Experiência com CRM.");
            }
            if (data.negotiation && data.negotiation.length > 20 && data.presentationComfort === 'sim') {
                score += 10;
                feedback.push("Habilidade em negociação e apresentação.");
            }

            // Seção 5: Alinhamento Cultural e Expectativas
            if (data.remunerationModel && (data.remunerationModel.toLowerCase().includes('desafio') || data.remunerationModel.toLowerCase().includes('motivação'))) {
                score += 10;
                feedback.push("Alinhamento com o modelo de remuneração por comissão.");
            }
            if (data.longTermSuccess === 'sim') {
                score += 5;
                feedback.push("Compreensão do sucesso a longo prazo.");
            }
            if (data.learningEnvironment && data.learningEnvironment.length > 20 && data.teamContribution && data.teamContribution.length > 20) {
                score += 10;
                feedback.push("Valoriza o aprendizado contínuo e a colaboração.");
            }
            if (data.motivation && (data.motivation.toLowerCase().includes('crescimento') || data.motivation.toLowerCase().includes('desenvolvimento'))) {
                score += 5;
                feedback.push("Motivação alinhada com o desenvolvimento profissional.");
            }
            if (data.productComfort === 'sim') {
                score += 5;
                feedback.push("Confortável em vender diversos produtos.");
            }

            // Seção 6: Cenário e Análise de Raciocínio
            if (data.scenarioQuestions && data.scenarioQuestions.length > 30 && data.mentoringArguments && data.mentoringArguments.length > 30 && data.financialImpact && data.financialImpact.length > 30) {
                score += 15;
                feedback.push("Boa capacidade de análise de cenário e raciocínio estratégico.");
            }

            // Monta a mensagem de pontuação preliminar
            let scoreMessage = `Sua pontuação preliminar: <span class="font-bold text-indigo-700">${score} pontos</span> (de um máximo de aproximadamente 100 pontos).`;

            if (score >= 70) {
                scoreMessage += "<br><span class='text-green-600 font-semibold'>Excelente! Seu perfil demonstra um forte alinhamento com as expectativas do Hub Business.</span>";
            } else if (score >= 40) {
                scoreMessage += "<br><span class='text-yellow-600 font-semibold'>Bom! Seu perfil tem potencial e demonstra algumas características importantes.</span>";
            } else {
                scoreMessage += "<br><span class='text-red-600 font-semibold'>Seu perfil demonstra algumas áreas a serem desenvolvidas para o alinhamento com a vaga.</span>";
            }

            scoreMessage += "<br><br><strong>Pontos de Destaque:</strong><ul>";
            feedback.forEach(item => {
                scoreMessage += `<li>- ${item}</li>`;
            });
            scoreMessage += "</ul>";

            scoreMessageElement.innerHTML = scoreMessage; // Exibe a pontuação no modal

            // Prepara o prompt para a análise da IA (Gemini API)
            const aiPrompt = `
                Analise as seguintes respostas de um candidato à vaga de Vendedor de Alta Performance no Hub Business.
                O perfil ideal do vendedor para o Hub Business busca:
                - Experiência comprovada em vendas B2B/B2C de alto valor, consultivas e complexas.
                - Conhecimento em gestão empresarial (financeira, pessoas, processos, marketing, vendas).
                - Proatividade, iniciativa (perfil hunter), orientação a resultados e foco em metas.
                - Inteligência emocional, persuasão, escuta ativa e capacidade analítica.
                - Adaptabilidade e aprendizado contínuo.
                - Domínio de técnicas de vendas consultivas (SPIN Selling, Challenger Sale).
                - Habilidade em gestão de pipeline e CRM.
                - Forte habilidade em negociação e fechamento de vendas de alto valor.
                - Alinhamento com a visão de longo prazo, mentalidade de crescimento e colaboração.
                - Motivação por ganhos significativos (meta de R$ 20.000/mês em comissão) e desenvolvimento profissional contínuo.

                Com base nas respostas abaixo, forneça um resumo conciso do perfil deste candidato, destacando seus pontos fortes e áreas que podem ser desenvolvidas em relação ao perfil ideal do Hub Business.

                --- Respostas do Candidato ---
                Experiência em Vendas: "${data.salesExperience || 'Não informado'}"
                Experiência em Vendas de Alto Valor: "${data.highValueSales === 'sim' ? (data.highValueSalesText || 'Sim, mas não detalhado') : 'Não'}"
                Conhecimento em Gestão: "${data.managementKnowledge || 'Não informado'}"
                Atualização de Mercado: "${data.stayUpdated || 'Não informado'}"
                Proatividade: "${data.proactivity || 'Não informado'}"
                Meta Desafiadora: "${data.challengingGoal || 'Não informado'}"
                Lidar com Objeções: "${data.objectionHandling || 'Não informado'}"
                Escuta Ativa: "${data.activeListening || 'Não informado'}"
                Adaptabilidade: "${data.adaptability || 'Não informado'}"
                Vendas Consultivas: "${data.consultativeSales === 'sim' ? (data.consultativeSalesText || 'Sim, mas não detalhado') : data.consultativeSales || 'Não informado'}"
                Experiência com CRM: "${data.crmExperience || 'Não informado'}"
                Negociação: "${data.negotiation || 'Não informado'}"
                Conforto em Apresentação: "${data.presentationComfort || 'Não informado'}"
                Modelo de Remuneração: "${data.remunerationModel || 'Não informado'}"
                Sucesso a Longo Prazo: "${data.longTermSuccess || 'Não informado'}"
                Ambiente de Aprendizado: "${data.learningEnvironment || 'Não informado'}"
                Contribuição para Equipe: "${data.teamContribution || 'Não informado'}"
                Motivação: "${data.motivation || 'Não informado'}"
                Produto Conforto: "${data.productComfort || 'Não informado'}"
                Perguntas de Cenário: "${data.scenarioQuestions || 'Não informado'}"
                Argumentos de Mentoria: "${data.mentoringArguments || 'Não informado'}"
                Impacto Financeiro: "${data.financialImpact || 'Não informado'}"
            `;

            let aiGeneratedSummary = "Não foi possível gerar o resumo do perfil pela IA.";
            try {
                const payload = {
                    contents: [{ role: "user", parts: [{ text: aiPrompt }] }],
                };
                const apiKey = ""; // A chave da API será fornecida pelo ambiente Canvas em tempo de execução
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    aiGeneratedSummary = result.candidates[0].content.parts[0].text;
                } else {
                    console.error("Estrutura de resposta da IA inesperada:", result);
                }
            } catch (error) {
                console.error("Erro ao chamar a API da IA:", error);
                aiGeneratedSummary = "Erro ao processar a análise de perfil pela IA. Tente novamente mais tarde.";
            } finally {
                loadingSpinner.classList.add('hidden'); // Esconde o spinner
                evaluationResultDiv.classList.remove('hidden'); // Mostra a seção de resultados
                aiSummaryElement.textContent = aiGeneratedSummary; // Exibe o resumo da IA

                // Salvar dados no Firestore (opcional: remova este bloco se quiser apenas Google Sheets)
                try {
                    // Garante que o Firebase e o userId estão prontos antes de tentar salvar
                    if (db && userId) {
                        const assessmentDocRef = doc(collection(db, `artifacts/${appId}/public/data/salesAssessments`));
                        await setDoc(assessmentDocRef, {
                            userId: userId,
                            timestamp: serverTimestamp(),
                            formData: data, // Todos os dados do formulário
                            preliminaryScore: score, // Pontuação gerada pelo JS
                            aiProfileSummary: aiGeneratedSummary // Resumo gerado pela IA
                        });
                        console.log("Dados salvos no Firestore com sucesso!");
                    } else {
                        console.warn("Firestore ou userId não estão prontos para salvar os dados. Pulando salvamento no Firestore.");
                    }
                } catch (dbError) {
                    console.error("Erro ao salvar dados no Firestore:", dbError);
                }

                // Enviar dados para o Google Sheets via Google Apps Script
                try {
                    // Prepara os dados para enviar para o Google Apps Script
                    // Certifique-se de que as chaves aqui correspondem aos nomes das colunas no seu Google Sheet
                    const sheetData = {
                        userId: userId,
                        fullName: data.fullName || '',
                        email: data.email || '',
                        phone: data.phone || '',
                        linkedin: data.linkedin || '',
                        salesExperience: data.salesExperience || '',
                        highValueSales: data.highValueSales || '',
                        highValueSalesText: data.highValueSalesText || '',
                        managementKnowledge: data.managementKnowledge || '',
                        stayUpdated: data.stayUpdated || '',
                        proactivity: data.proactivity || '',
                        challengingGoal: data.challengingGoal || '',
                        objectionHandling: data.objectionHandling || '',
                        activeListening: data.activeListening || '',
                        adaptability: data.adaptability || '',
                        consultativeSales: data.consultativeSales || '',
                        consultativeSalesText: data.consultativeSalesText || '',
                        crmExperience: data.crmExperience || '',
                        negotiation: data.negotiation || '',
                        presentationComfort: data.presentationComfort || '',
                        remunerationModel: data.remunerationModel || '',
                        longTermSuccess: data.longTermSuccess || '',
                        learningEnvironment: data.learningEnvironment || '',
                        teamContribution: data.teamContribution || '',
                        motivation: data.motivation || '',
                        productComfort: data.productComfort || '',
                        scenarioQuestions: data.scenarioQuestions || '',
                        mentoringArguments: data.mentoringArguments || '',
                        financialImpact: data.financialImpact || '',
                        preliminaryScore: score,
                        aiProfileSummary: aiGeneratedSummary
                    };

                    const sheetResponse = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors', // Usado para evitar problemas de CORS, mas impede a leitura da resposta
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(sheetData)
                    });

                    console.log("Tentativa de envio para Google Sheets. Status da resposta:", sheetResponse.status);
                    // Como mode: 'no-cors' impede a leitura da resposta, não podemos verificar o sucesso diretamente aqui.
                    // O sucesso será confirmado ao ver os dados na sua planilha.

                } catch (sheetError) {
                    console.error("Erro ao enviar dados para Google Sheets:", sheetError);
                }

                // Reabilita o botão de envio
                submitButton.disabled = false;
                submitButton.textContent = 'Enviar Questionário';
            }
        });
    </script>
</body>
</html>
